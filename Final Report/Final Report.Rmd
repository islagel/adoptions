---
title: "Final Report"
author: "Isaac Slagel and Jack Welsh"
header-includes: \usepackage{dcolumn} \usepackage{float}
output:
  pdf_document:
    fig_caption: yes
    fig_height: 3
    fig_width: 4.5
editor_options:
  chunk_output_type: console
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```

```{r, include = FALSE}
library(tidyverse)
library(readr)
library(lubridate)
library(survival)
library(survminer)
library(kableExtra)
library(knitr)
library(lme4)
library(stargazer)

data_path <- here::here("adoptions.csv")
adoptions <- read_csv(data_path)
```


## Introduction  


  According to an ASPCA estimate, over 6.5 millions animals enter a shelter system every year. (Shelter Intake and Surrender, ASPCA). After entering the shelter system animals are either rehabilitated and sent to homes or euthanized. Animal shelters, while running mostly on revenue from donations and adoption fees, routinely run into perminant defieciets and must be supported with money from local governments (Goselin et. al. 2011). Knowing more about the outcomes of animals from these shelters could help us minimize the percent of animals that need to be euthanized. Further, by identifying which animals are less likely to be adopted, we can help shelters allocate resources to minimize the time these animals spend in the shelter system.

  Our research looks into animal shelters in the Dallas area using a dataset provided by the city of Dallas on dallasopendata.com. This data includes information about every animal that has been brought into an animal shelter in the Dallas area. There are `r nrow(adoptions)` individual animals in this dataset with with information about when and where the animal was found, the health of the animal on arrival, and whether the animal was adopted, euthinized or transfered.

  Recent research on animal shelters have consistantly shown that outcomes for pitbulls are consistantly worse than other dog breeds (Patronek & Crowe 2018, Lepper et al 2002). We are interested in seeing if these this trends exist in the Dallas animal shelter system. If these trends do occur, how to they manifest in the quantative insights we glean from our analysis. Do pitbulls face greater odds of euthanization than other breeds? Are pitbulls adopted at lower rates than other species of dogs. Do certain animal shelters handle pitbulls better or worse than others?



## Materials and Methods


  We accessed our data from the Dallas Open Data website. This website contains many public datasets, including [animal shelter records](https://www.dallasopendata.com/City-Services/Dallas-Animal-Shelter-Data/7h2m-3um5). Anyone can request an access key to this dataset and then download it. We downloaded the data, selected the variables of interest to us, and created a .csv file in the CreateDataset.Rmd file. Our dataset is saved as adoptions.csv. The initial variables from this dataset are described below in Table 1.

```{r variable table, echo = FALSE}
variables <- c("Variable Name", "Variable Role", "Variable Type", "Description")

out_dead  <- c("out_dead", "response", "bianary", "Whether or not an animal was dead at the outcome")
days_in_shelter <- c("days_in_shelter", "response", "time", "The number of days an animal spent in the animal shelter")
summer <- c("summer", "explanatory", "bianary", "Whether or not an animal had its outcome in May-Sept")
pitbull <- c("pitbull", "explanatory", "bianary", "Whether or not a dog was a pitbull")

chip <- c("chip_status", "explanatory", "bianary", "Whether or not an animal had a scannable chip")

contagious <- c("contagious", "potential confounder", "bianary", "Whether or not an animal was described as 'contagious' at intake")
treatable <- c("treatable", "potential confounder", "bianary", "Whether or not an animal was described as 'treatable' at intake")

tab <- rbind(out_dead, days_in_shelter, summer, pitbull, chip, contagious, treatable)

colnames(tab) <- variables
rownames(tab) <- NULL

kable(tab,
      format = "latex" ,
      booktabs = T,
      linesep = "",
      caption = "Description of Variables") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"), font_size = 12)

```


  After we imported our dataset we used a variety of variables that were coded as factors and string to create a fleet of indicator variables: `adopted`, `chip_status`, `summer`, `treatable_intake`, `adopted`, `dead`. These indicator variables were created to streamline our modeling process. They allow us to increase the interpretability of variables with multiple categories (like outcome_type). We also modified the intake date and outcome date variables to create a `days_in_shelter` variable. This variable is a neccesary outcome for the survival analysis portion of the data.

  In order to fit a quiasibinomial model, we had to summarise our dataset with respect to certain variables we controlled for in our model. One interesting issue that we encountered was the effect that the dataset used had on SE estimates. If we summarized our data for each specific model, parameter estimates had increased SEs and more insignificant p-values. However, if we fit all of our models on the same, more extensive, summary table, SEs were small and parameters were more likely to be significant. We decided to proceed with the latter option, as it allows us to carry out nested F tests and would be more like a modeling process for true grouped data. This could mean that our SEs are artifically low.

  We used quasibinomial regression to compare how the outcomes of pitbulls differ from other breeds of dog. In fitting this model we had to control for a plethora of cofounding variables including season of outcome, chip status, and intake condition of the animal. We also considered a multilevel model to account for difference in district correlation.

  We also fit multilevel logistic regression models to compare ourcomes after accounting for correlation within city council districts. Our modeling process took on a similar approach to the binomial regression, we examined differences in odds of dying for pitbulls and non-pitbulls after accounting for differences in chip status, and season.  

  To investigate the ammount of time that dogs spend in the animal shelter before dying we used a Cox proportional hazards model. Cox proportional hazards is a semi parametric model used in survival anslysis to explain how variables of interest affect the time until an event occurs. As the name 'survival analysis' suggests, this method is commonly used to investigate what factors affect time till death. This is done by comparing hazard rates using a hazard ratio. The hazard ratio is the ratio of hazard rates between groups, a hazard rate is the rate at which the outcome is happening. So, this type of model investigates how variables affect the rate at which outcomes happen.

  The Cox proportional hazards model is a semiparametric model, this means that this model does not make assumptions about the undMrlying distribution of data, but it does assume that the hazard ratios for any two individuals is constant over time. In other words, the risk of the outcome of interest happening for one individual at every time point must be proportionally constant to all other individuals.

  This model follows the general form $h(t)=h_0(t)*\exp\{b_1*x_1+b_2*x_2+....+b_p*x_p\}.$ where $h_0(t)$ is called the baseline hazard rate and is an estimation of the hazard rate of an individual at time t with $x_1$ to $x_p$ all equal to 0 having the outcome of interest already happened. $b_1$ to $b_p$ are the hazard ratio estimates. These are estimations of how much the hazard rate will change at time t compared to the baseline hazard rate at time t. This model also allows us to censor our data. We do not know if an animal that is trasfered dies in the animal shelter, so that variable is censored at the time of the otcome. This us allows us to consider all of our data without making assumptions on whether the animal is dead or alive.


## Results


#### EDA Results: Pitbull


  To look into how pitbulls are handled within animal shelters, we decided to explore how the outcomes of pit bulls may differ from non-pitbulls. Table 1 describes the differences in outcome rates for non-pitbulls compared to pitbulls.


```{r pitbull EDA table, echo = FALSE}
proper=function(x) paste0(toupper(substr(x, 1, 1)), tolower(substring(x, 2)))

adoptions %>%
  filter(dog == 1) %>%
  mutate(outcome = as.factor(outcome_type),
         pitbull = as.factor(pitbull)) %>%
  group_by(pitbull, outcome_type) %>%
  dplyr::count()%>%
  rename("freq"=n)%>%
  group_by(pitbull)%>%
  mutate(freq = freq/ sum(freq))%>%
  spread(outcome_type,freq) %>%
  gather(key = Outcome, value = value, -pitbull) %>%
  spread(key = pitbull, value = value) %>%
  select(1,3,2) %>%
  rename( "Pitbull (%)" = `1`, "Non-Pitbull (%)" = `0`) %>%
  mutate(Outcome = proper(Outcome), `Pitbull (%)` =100*`Pitbull (%)` , `Non-Pitbull (%)`=`Non-Pitbull (%)`*100 )%>%
  arrange(desc(`Pitbull (%)`))%>%
  kable(digits = 2,
        linesep = "",
        format = "latex",
        booktabs = T,
        caption = "Pitbull Outcomes")%>%
  kable_styling(latex_options =  c("striped", "HOLD_position"), font_size = 7)

```


  We see that pit bulls, while only adopted at a slightly lower rate (~5%), are euthanized at well over double the rate of other dogs. Further, we see that other dogs have a much higher chance of being transferred to another facility or returned to their owner. This propted us to create a variable `out_dead` which identifies whether a dog had an outcome of death ("EUTHANIZED" or "DIED") or not ("TRANSFER", "RETURNED TO OWNER", "ADOPTION"). To get a better understanding of the relationship between pitbull and `out_dead`, we decided to control for things like chip status, intake condition, and season of outcome in our quasibinomial regression.

#### Quasi-Binomial Models for Dog Outcomes

```{r pitbull model table, results = "asis", echo = FALSE, message=FALSE}

pitbull_binom <- adoptions %>%
  filter(!str_detect(intake_subtype, "(DEAD)|(DIED)")) %>%
  filter(dog == 1) %>%
  mutate(out_dead = outcome_type %in% c("DEAD ON ARRIVAL", "EUTHANIZED", "DIED"),
         summer = ifelse(month %in% c(5, 6, 7, 8, 9), 1, 0),
         chip_status = ifelse(chip_status=="SCAN CHIP", 1, 0),
         contagious=ifelse(grepl(".*[^NON-]CONTAGIOUS", intake_condition),1,0),
         treatable=ifelse(grepl("^TREATABLE.*", intake_condition),1,0)) %>%
  group_by(pitbull, chip_status, summer, contagious, treatable) %>%
  summarize(prop_dead = sum(out_dead)/n(), count = n())


#### MODEL 1 ####

pitbull_model1_quasi <- glm(prop_dead ~ pitbull + chip_status + summer , weights = count, family = quasibinomial, data = pitbull_binom)

#### MODEL 2 ####

pitbull_model2_quasi <- glm(prop_dead ~ pitbull + chip_status +
                      summer + contagious , weights = count,
                    family = quasibinomial, data = pitbull_binom)


#### MODEL 3 ####


pitbull_model3_quasi <- glm(prop_dead ~ pitbull + chip_status +
                      summer + contagious + treatable , weights = count,
                    family = quasibinomial, data = pitbull_binom)

#### TABLE ####
ci.func <- function(model){
  exp(confint(model))
}

p.func <- function(model){
  coef(summary(model))[,4]
}

stargazer(pitbull_model1_quasi, pitbull_model2_quasi, pitbull_model3_quasi,
          title="Modeling Dog Outcomes in Dallas Animal Shelters",
          type='latex',
          align=TRUE,
          header=FALSE,
          table.placement = "H",
          apply.coef = exp,
          ci=TRUE,
          ci.custom = list(ci.func(pitbull_model1_quasi),
                           ci.func(pitbull_model2_quasi),
                           ci.func(pitbull_model3_quasi)),
          p.auto = FALSE,
          p = list(p.func(pitbull_model1_quasi),
                   p.func(pitbull_model2_quasi),
                   p.func(pitbull_model3_quasi)),
          dep.var.labels=c("Proportion of dogs who died"),
          covariate.labels = c("Intercept","Pitbull",
                              "Scannable Chip", "Summer Outcome",
                              "Contagious", "Treatable At Intake",
                            "Overdispersion Parameter"),
          intercept.bottom = FALSE,
          omit.stat = "n",
          add.lines = list(c("Overdisperson Parameter", "139.72", "111.46",  "6.27"),
                           c("Nested F Test","", "F: 5.1142^*", "F: 313.62^{***}")))

```

```{r, include = FALSE}
anova(pitbull_model1_quasi, pitbull_model2_quasi, test = "F")
anova(pitbull_model2_quasi, pitbull_model3_quasi, test = "F")
exp(confint(pitbull_model3_quasi))
```

We see in Table 3 that all of our models have variable estimates that are significant including Model 3 which accounted for whether or not an animal was deemed "treatable" at the time of intake. Further, by two F tests we see each of our models is an improvement on the one before it (Model 1 $\rightarrow$ Model 2: F = 5.1141, p-value = 0.031) (Model 2 $\rightarrow$ Model 3: F = 313.62, p-value <<< .05).

Procceding with Model 3 as our best model of dog outcomes from the animal shelter, we glean several insights about the relationships between certain characteristics of dogs and those animal's outcomes from the shelter. For instance, if a dog is a pitbull, we expect it's odds of leaving the animal shelter dead increase by 348%, after controlling for chip status, season, and intake condition. Further, if a dog is a pitbull we are 95% confident that the true increase in odds of death at outcome is between 302% and 402%. Yikes! On the other hand, if a dog comes into the shelter with a scannable chip, we expect the animals odds of dying within the shelter system to drop by about 22%, after controlling for pitbull, season, and intake condition. Interestingly enough, if a dog has its outcome in the summer, the odds of that outcome being death are about 47% higher, controlling for breed, chip status, and intake condition.

#### EDA Results: Effect of Council District

An additional variable that was avalible in our dataset was `council_district`. The city of Dallas has 14 council districts. We are concerned that there may be some correlation between outcomes for each council district. 

```{r, echo=FALSE, fig.align="center", fig.cap="Proportion of dogs with dead outcomes by council district."}
mlm_dead<- adoptions %>%
  filter(!str_detect(intake_subtype, "(DEAD)|(DIED)")) %>%
  filter(dog == 1) %>%
  mutate(out_dead = outcome_type %in% c("DEAD ON ARRIVAL", "EUTHANIZED", "DIED"),
         summer = ifelse(month %in% c(5, 6, 7, 8, 9), 1, 0),
         chip_status = ifelse(chip_status=="SCAN CHIP", 1, 0),
         contagious=ifelse(grepl(".*[^NON-]CONTAGIOUS", intake_condition),1,0),
         treatable=ifelse(grepl("^TREATABLE.*", intake_condition),1,0))

mlm_dead %>%
  group_by(council_district)%>%
  summarise(prop_dead = sum(out_dead)/n())%>%
  filter(!is.na(council_district))%>%
  ggplot(aes(x=as.factor(council_district), y = prop_dead)) +
  geom_bar(stat = "identity")+
  xlab("City Conucil District")+
  ylab("Proportion Dead")

```

  From Figure 1 we see that the proportion of dogs dying in animals shelters differs by city council district. City council district 12 seems to be the highest at 19.2% of the dogs are dying in the shelter system, and city council district 11 has the lowest at only 12.1% of the dogs dying in the shelter system.


#### Random Intercepts Model for Dog Outcomes

  During our EDA we found that there was a difference in dog deaths between city council districts. To account for this we used a random intercepts logistic regression model.

Our model has two levels,

- Level 1

$$\log(\frac{p_{ij}}{1-p_{ij}})=a_i+b_i*{\rm (summer)}_{ij}+c_i*{\rm  (pitbull)}_{ij}+d_i*(\rm chip\ status)_{ij}$$



- Level 2
\begin{eqnarray*}  
  a_i&=\alpha_0+u_i\\
  b_i& =\beta_0\\
  c_i& =\gamma_0\\
  d_i& =\delta_0.\
\end{eqnarray*}  

The variance component is described by:

$$u_i=N(0,\sigma^2_u).$$

  From Table 4 we note that the odds of a pitbull dying in the animal shelter are 3.42 times higher than for non pitbulls accounting for season, chip status, and intake condition. As expected, the odds of a contagious dog dying at the animal shelter are 3.96 time higher than a non contagious dog accounting for whether the dog is treatable, the season, chip status and pitbull. Also, unsuprisingly, if a dog enters the animal shelter with a treatable intake the odds of dying in the animal shelter decrease by 84% controlling for whether the dog is contagious on intake, the season, and chip status.


```{r, echo=FALSE, include=F}
mod.2.dead=glmer(out_dead~pitbull + chip_status +
                      summer + contagious + treatable
                 +(1|council_district), data=mlm_dead, family = "binomial")
summary(mod.2.dead)
exp(fixef(mod.2.dead))
```


```{r,  results = "asis", echo = FALSE, message=FALSE}
ci.func <- function(model){
  exp(confint(model, method="Wald"))
}


p.func <- function(model){
  coef(summary(model))[,4]
}

stargazer(mod.2.dead,
          title="Modeling Dog Deaths in Animal Shelters using \n Random Intercepts Logistic Regression",
          type='latex',
          align=TRUE,
          header=FALSE,
          table.placement = "H",
          apply.coef = exp,
          ci=TRUE,
          ci.custom = list(ci.func(mod.2.dead)),
          p.auto = FALSE,
          p = list(p.func(mod.2.dead)),
          dep.var.labels=c("Proportion of dogs who died"),
          covariate.labels = c("Intercept","Pitbull",
                              "Scannable Chip", "Summer Outcome",
                              "Contagious", "Treatable At Intake"))

```


#### EDA Results: Time Till Death for Dogs


```{r, echo=FALSE, message=FALSE, include=FALSE, fig.align="center"}
adoptions_1 <- read_csv(data_path)

adoptions_surv=adoptions_1%>%
  mutate(intake_date=as.Date(intake_date),
         outcome_date=as.Date(outcome_date))%>%
  mutate(days_in_shelter=difftime(outcome_date, intake_date, units = "days"),
         days_in_shelter=as.numeric(days_in_shelter)+1)%>%
  filter(outcome_type!="DEAD ON ARRIVAL")%>%
  mutate(death=ifelse(outcome_type=="DIED", 1, 0),
         death=ifelse(outcome_type=="EUTHANIZED", 1, death),
         censored=ifelse(death==1, 2, 1))%>%
  filter(animal_type=="DOG")%>%
  mutate(animal_breed=as.factor(animal_breed))%>%
  mutate(healthy_intake=ifelse(grepl("^HEALTHY.*",intake_condition),1,0),
         contagious_intake=ifelse(grepl(".*[^NON-]CONTAGIOUS", intake_condition),1,0),
         untreatable_intake=ifelse(grepl(".*(UNTREATABLE).*", intake_condition),1,0),
         treatable_intake=ifelse(grepl("^TREATABLE.*", intake_condition),1,0),
         manageable_intake=ifelse(grepl(".*MANAGEABLE.*", intake_condition),1,0),
         rehabitable_intake=ifelse(grepl(".*REHABILITABLE.*", intake_condition),1,0),
         normal_intake=ifelse(grepl(".*NORMAL.*", intake_condition),1,0),
         chip_status = ifelse(chip_status=="SCAN CHIP", 1, 0),
         summer = ifelse(month %in% c(5, 6, 7, 8, 9), 1, 0))
```


```{r, echo=F, fig.align="center", fig.cap="Kaplan–Meier Curves for pitbull (blue) and non-pitbull survival (pink)."}
surv.mod=survfit(Surv(days_in_shelter, censored)~pitbull,
               data=adoptions_surv)
surv.mod$
ggsurvplot(surv.mod, data=adoptions_surv, legend = "none")
```

When investigating the ammount of time that dogs spend in the animal shelter before dying or having another outcome we noticed that pitbulls die much more often (see Table 2). Furthermore, the probability of surviving decreases faster for pitbulls than for non pitbulls. 

```{r}
time_in_animal_shelter=adoptions_surv%>%
  group_by(pitbull)%>%
  summarise(`Average Number of Days in Shelter`=mean(days_in_shelter, na.rm=TRUE))%>%
  mutate(`Pitbull`=ifelse(pitbull==0,"No", "Yes"))%>%
  select(`Pitbull`, `Average Number of Days in Shelter`)
  
kable(time_in_animal_shelter,
      format = "latex" ,
      booktabs = T,
      linesep = "",
      caption = "Average Time Spent in Animal Shelter") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"), font_size = 12)

```

We also found that the average time a pitbull spends in the shelter is longer than the average time a non pitbull spends in shelter. Th

#### Modeling Time Till Death for Pitbulls

  We approached this task by using Cox proportional hazards. We wanted to control for `chip_status` and `summer`, but the proportional hazards assumption was no longer met when we added these confounding variables to our model (see appendix). To get around this, we stratified our data by both `summer` and `chip_status`. For each of these 4 strata we fit the model $h(t)=h_0(t)*\exp\{b_1*{\rm Pitbull} \}$. Our findings are summarised in Table 5 below. 


```{r, echo=FALSE, include=FALSE}
adop.1.1=adoptions_surv%>%
  filter(summer==1, chip_status==1)
adop.0.1=adoptions_surv%>%
  filter(summer==0, chip_status==1)
adop.1.0=adoptions_surv%>%
  filter(summer==1, chip_status==0)
adop.0.0=adoptions_surv%>%
  filter(summer==0, chip_status==0)

surv.mod.1.1=coxph(Surv(days_in_shelter, censored)~pitbull,
               data=adop.1.1)
surv.mod.0.1=coxph(Surv(days_in_shelter, censored)~pitbull,
                   data=adop.0.1)
surv.mod.1.0=coxph(Surv(days_in_shelter, censored)~pitbull,
                   data=adop.1.0)
surv.mod.0.0=coxph(Surv(days_in_shelter, censored)~pitbull,
                   data=adop.0.0)
```


```{r, results = "asis", echo = FALSE, message=FALSE}

ci.func <- function(model){
  exp(confint(model))
}


stargazer(surv.mod.1.1, surv.mod.1.0, surv.mod.0.1, surv.mod.0.0,
          align=TRUE,
          title = "$b_1$ Estimates for Each Strata",
          header=FALSE,
          table.placement = "H",
          apply.coef = exp,
          ci=TRUE,
          ci.custom = list(ci.func(surv.mod.1.1), ci.func(surv.mod.1.0), ci.func(surv.mod.0.1), ci.func(surv.mod.0.1), ci.func(surv.mod.0.0)),
          dep.var.caption = "Strata",
          dep.var.labels = "",
          model.numbers = FALSE,
          column.labels = c("Summer and Chip", "Summer and No Chip", "Not Summer and Chip", "Neither Summer or Chip"),
          omit.stat = "all"
          )
```


  We found that in all 4 strata of the data the coefficient for pitbull is significant. The hazard ratio ranged from 1.69 in the strata where it is not the summer and all the animals have chips to 1.94 in the not summer and all animals do not have a chip dataset. In layman's terms this means that on average at any time during an animals stay at the animal shelter 1.69 to 1.94 times as many pitbulls have died as non pitbulls.




## Discussion


  We have demonstrated clear evidence that pitbulls that come into the Dallas animal shelter system have a far higher risk of dying in the shelter system. We demonstrated this consistently through a binomial approach, a multilevel approach, and a survival analysis based approach. We would urge the Dallas animal shelter system to consider allocating more resources to pitbulls coming into the shelter. Lampe and Witte 2015 evidenced the effect that photogenicity can have on animal adoption. Perhaps by better marketing at risk animals, implementing more training programs for these animals, or advocating for more pitbulls to be fostered, fewer pitbulls would need to be euthanized in the Dallas animal shelter system.

  
  In our modeling approach we used our findings in our exploratory data analysis and previous literature models to drive our choices for confounding variables to include in our models. In both the quasibinomial and random intercepts model we controlled for chip status, intake condition, and season of outcome. Further, in the random intercepts model we adjusted our model for possible correllation within council districts. In our Cox proportional hazards modeling we stratified our model season and chip status to better meet the proprtional hazards assuption. We would like to better our understanding of the intake condition and outcome condition variables in future research. In these variables shelter workers described animals as being "healthy", "treatable", "contagious", etc. but the exact definitions and consistancies of these descriptions are not known.
  


  Conclusions about animal outcomes of animals in shelters from this report can only be extended to the city of Dallas. While our sample size is totally representative for this population, we cannot account for differences that would be encountered in other municipalities, say higher adoption rates or less stigma against certain breeds of dog. Further, we cannot be sure that the trends observed in this paper will continue into the future. Anti-pitbull advocacy groups like [National Pitbull Victims Awareness](https://www.nationalpitbullvictimawareness.org/) and pro-pitbull advocacy groups like [Love-a-Bull](http://love-a-bull.org/resources/statistics-pit-bull-bites-community-safety/) are at odds trying to sway public opinion and policy reguarding the handling of pitbulls in animal shelters. If changes in public percecption of pitbulls or the policy that surrounds them changes, our model will lose it's generalizability to Dallas.


  A limitation of our study is that we do not know what happens to animals after they have been transferred out of the animal shelter. In our analysis we have viewed this outcome as a live outcome, but for all we know these animals could go on to another shelter where they are euthanized. Depending on the validity of our assumption, we could be adding some bias to our conclusions. Additionally, there is not consistant infomration on the criteria used by shelters to evaluate animals intake conditions. We look for key words that indicated the health of the animal. However we are not sure how consistant these evaluations are across all Dallas animal shelters.


  Our analysis was effective in approaching a particular question from a number of unique approaches. We implemented a binomial regression, a random intercepts logistic regression, and a Cox proportional hazards model to investigate how pitbull outcomes differ from other breeds of dogs after accounting for confounding variables. Further, the results from each of these investigations tell a similar story about the increase rates of death for pitbulls in the Dallas animal shelter system. 


  One weakness of our analysis came in the quasibinomial modeling of dog outcomes. We found that the predicted SE and significace of our parameter estimates depended extensivly on how we summarised our dataset. We chose to run our models off of a single summarised dataset with all of our confounders of interest. We justify this because this is how data of this kind would hopefully be collected and by doing this we can use nested-F tests to compare our models. Nonetheless, this approach may be giving us underestimated SEs and overstated precision. The reason for this phenomonoa remains unclear and could be investigated in future research. 


  Future work could be done in Dallas to help minimize the number of animals which need to be euthanized. By identifying specific at-risk groups of animals, more resources could be allocated to advocating for these animals or transfering them to other No-Kill shelters. We would recomend any additional research to work directly with the Dallas Animal Shelter group. By having a direct contact with the group doing data collection, a statistician will be able to better identify pressing issues of the group and verify certain assumptions that we have not been able to verify.


## Works Cited


[Goselin, C., Letson, K., McGuinniss, K., Walters, A., & Fagan, J. M. (2011). Animal shelter funding.](https://rucore.libraries.rutgers.edu/rutgers-lib/38418/PDF/1/play/)

[Shelter Intake and Surrender. (n.d.). Retrieved from https://www.aspca.org/animal-homelessness/shelter-intake-and-surrender](https://www.aspca.org/animal-homelessness/shelter-intake-and-surrender)

[Lampe, R., & Witte, T. H. (2015). Speed of dog adoption: Impact of online photo traits. Journal of applied animal welfare science, 18(4), 343-354.](https://www.tandfonline.com/doi/abs/10.1080/10888705.2014.982796)

[Lepper, M., Kass, P. H., & Hart, L. A. (2002). Prediction of adoption versus euthanasia among dogs and cats in a California animal shelter. Journal of Applied Animal Welfare Science, 5(1), 29-42.](https://www.tandfonline.com/doi/abs/10.1207/S15327604JAWS0501_3)

[Patronek, G. J., & Crowe, A. (2018). Factors Associated with High Live Release for Dogs at a Large, Open-Admission, Municipal Shelter. Animals : an open access journal from MDPI, 8(4), 45. doi:10.3390/ani8040045](https://www.mdpi.com/2076-2615/8/4/45)

[Posage, J. M., Bartlett, P. C., & Thomas, D. K. (1998). Determining factors for successful adoption of dogs from an animal shelter. Journal of the American Veterinary Medical Association, 213(4), 478-482.](https://europepmc.org/abstract/med/9713528)





## Annotated Appendix

All of our work can be accessed in a public Github repository at https://github.com/islagel/adoptions. 


  -	Tables and figures that are informative but were not referenced specifically in the main report.  Include a short annotation – one or two sentences on what they show.
  -	R scripts and output (annotated) so that I can trace how you constructed your final data set, what models you ran to produce the results quoted in your report, and what intermediate models you also considered.
  -	Description of statistical modeling steps that were not included in the main body of your report.  Possible entries here include: How you handled missing data. Evaluation of assumptions. Outlier analysis and how you decided to deal with any outliers along with rationale for your decision. Describe hypotheses testing you performed during model building and how you decided on the explanatory variables you ultimately included in your final model. Assessment of the final model.
  -	How you went from the model output in R to interpretations in your report (e.g. exponentiate coefficients, then take inverse)
  -	Anticipate questions someone might have after reading your report, and make sure those questions can be answered with information in the appendix.
  -	A citation for each reference article (in APA format or something similar) you included in your proposal.  Also include a link, if appropriate.  Remember that you must have the entire paper and not just an abstract, and at least two must be from peer-reviewed journals.


### Dogs vs Cats

#### EDA Results: Dog and Cat Differences



#### Modeling Dog and Cat Differences

 In our modeling of Dog and Cat differences we used used binomial regression. To model this we considered the following model:

$$log(\frac{p_{i}}{1-p_{i}})=\beta_0+\beta_1 {\rm (Dog)} + \beta_i{\rm (Confounder)}_i$$

We considered several models with different confounders controled for based on findings in the literature and our EDA. We were not able to find any significant difference in the odds of death between dogs and cat. We conclude that there is not evidence of a significant difference between dogs and cats in odds of dying in an animal shelter after accounting for chip_status, season of outcome, and intake condition.

```{r}
cat_dog_binom <- adoptions %>%
  filter(!str_detect(intake_subtype, "(DEAD)|(DIED)")) %>%
  filter(dog == 1 | cat == 1) %>%
  mutate(out_dead = outcome_type %in% c("DEAD ON ARRIVAL", "EUTHANIZED", "DIED"),
         summer = ifelse(month %in% c(5, 6, 7, 8, 9), 1, 0))%>%
  mutate(chip_status = ifelse(chip_status=="SCAN CHIP", 1, 0)) %>%
  group_by(dog, chip_status, summer, stray) %>%
  summarize(prop_dead = sum(out_dead)/n(), count = n())

####### MODEL 1: dog #########

dogcat_model1_binom <- glm(prop_dead ~ dog, weights = count, family = binomial, data = cat_dog_binom)

dogcat_model1_quasi <- glm(prop_dead ~ dog, weights = count, family = quasibinomial, data = cat_dog_binom)

summary(dogcat_model1_binom)
exp(confint(dogcat_model1_binom))

summary(dogcat_model1_quasi)
exp(confint(dogcat_model1_quasi))

####### MODEL 2: dog + summer #########

dogcat_model2_binom <- glm(prop_dead ~ dog + summer, weights = count, family = binomial, data = cat_dog_binom)

dogcat_model2_quasi <- glm(prop_dead ~ dog + summer, weights = count, family = quasibinomial, data = cat_dog_binom)

summary(dogcat_model2_binom)
exp(confint(dogcat_model2_binom))

summary(dogcat_model2_quasi)
exp(confint(dogcat_model2_quasi))


####### MODEL 3: dog + chip ######

dogcat_model3_binom <- glm(prop_dead ~ dog + chip_status, weights = count, family = binomial, data = cat_dog_binom)

dogcat_model3_quasi <- glm(prop_dead ~ dog + chip_status, weights = count, family = quasibinomial, data = cat_dog_binom)

summary(dogcat_model3_binom)
exp(confint(dogcat_model3_binom))

summary(dogcat_model3_quasi)
exp(confint(dogcat_model3_quasi))

####### MODEL 4: summer + dog + summer:dog ######

dogcat_model4_binom <- glm(prop_dead ~ summer+dog+ summer:dog, weights = count, family = binomial, data = cat_dog_binom)

dogcat_model4_quasi <- glm(prop_dead ~ summer+dog+ summer:dog, weights = count, family = quasibinomial, data = cat_dog_binom)

summary(dogcat_model4_binom)
exp(confint(dogcat_model4_binom))

summary(dogcat_model4_quasi)
exp(confint(dogcat_model4_quasi))

####### MODEL 5: stray ######

dogcat_model5_binom <- glm(prop_dead ~ dog + stray, weights = count, family = binomial, data = cat_dog_binom)

dogcat_model5_quasi <- glm(prop_dead ~ dog + stray, weights = count, family = quasibinomial, data = cat_dog_binom)

summary(dogcat_model5_binom)
exp(confint(dogcat_model5_binom))

summary(dogcat_model5_quasi)
exp(confint(dogcat_model5_quasi))
```

#### Cox Proportional Hazards

As you can see below when we include chip_status and summer in the cox proportional hazards model the kaplan meir curves begin to overlap and cross which means the the hazards are no longer proportional.

```{r}

kp_curve.all.confounders=survfit(Surv(days_in_shelter,censored)~pitbull+summer+chip_status,
      data=adoptions_surv)

ggsurvplot(kp_curve.all.confounders, data=adoptions_surv)

```

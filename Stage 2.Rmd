---
title: "Stage 2: Exploratory Data Analysis"
author: "Isaac Slagel, Jack Welsh, Va Yang"
date: "4/18/2019"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
library(tidyverse)
library(readr)
adoptions <- read_csv("~/Stats 316 S19/Project/adoptions/adoptions.csv")

```
#EDA Main Report

2. EDA Report.  In no more than 3 pages, summarize the main findings of your exploratory analysis, referring to specific plots and summary statistics where necessary.  In addition, describe your plans for building models to address important research questions, including which variables will be important to consider in light of your exploratory analyses.

•	No more than 3 pages 
•	Begin with a short paragraph introducing your project and primary research questions.  (This introduction will be expanded into several paragraphs for the final paper.)
•	Use your graphical and numerical summaries to tell a story, supporting your conclusions with summary statistics.  Weave numerical summaries seamlessly into your text, and refer to graphs where appropriate.
•	Include at least 2 interesting plots (hopefully more!).  Name each plot (e.g. Figure 1) so they are easily referred to in your report, and format the figures neatly within your report (without taking up too much space).  Exploratory plots can be loose with captions and axis labels, but for your final paper it is essential that your figures have meaningful captions and axis labels! 
•	Preview directions you plan to go with modeling.  What models will you begin by fitting, and what variables will be involved.
•	Write well!  Complete sentences, good flow, proper grammar, the works…

\pagebreak
#Annotated Appendix and References 



(b) Your Annotated Appendix and References section should include these elements:
•	Definitions of important variables and the source of the data.
•	R scripts and (commented) output so that I can trace how you constructed your final data set, what the results of your exploratory data analyses were, and what plots you generated.
•	A short annotation – one or two sentences – on what each analysis shows.
•	Tables and figures that are informative but were not referenced specifically in the main report.  Include a short annotation – one or two sentences on what they show.
•	A citation for each reference article (in APA format or something similar) you included in your proposal.  Also include a link, if appropriate.  Remember that you must have the entire paper and not just an abstract, and at least two must be from peer-reviewed journals.

## Exploring animal_breed
```{r}

## Which dog breeds are in our data? 
adoptions %>%
  filter(animal_type == "DOG") %>%
  mutate(animal_breed = fct_lump(animal_breed, n=15)) %>%
  group_by(animal_breed) %>%
  count(sort = TRUE)

adoptions %>%
  filter(animal_type == "DOG") %>%
  mutate(animal_breed = fct_lump(animal_breed, n=15)) %>%
  group_by(animal_breed) %>%
  count(sort = TRUE)%>%
  ggplot(aes(x=fct_reorder(animal_breed,n), y=n))+
  geom_bar(stat="identity")+
  coord_flip()

## Which cat breeds are in our data?
adoptions %>%
  filter(animal_type == "CAT") %>%
  mutate(animal_breed = fct_lump(animal_breed, n=10)) %>%
  group_by(animal_breed) %>%
  count(sort = TRUE)

adoptions %>%
  filter(animal_type == "CAT") %>%
  mutate(animal_breed = fct_lump(animal_breed, n=15)) %>%
  group_by(animal_breed) %>%
  count(sort = TRUE)%>%
  ggplot(aes(x=fct_reorder(animal_breed,n), y=n))+
  geom_bar(stat="identity")+
  coord_flip()


## Which types of wildlife are in our data?
adoptions %>%
  filter(animal_type == "WILDLIFE") %>%
  mutate(animal_breed = fct_lump(animal_breed, n=10)) %>%
  group_by(animal_breed) %>%
  count(sort = TRUE)
```

## Exploring animal origin

```{r}
adoptions %>%
  filter(dog == 1 | cat == 1) %>%
  ggplot(aes(x=animal_origin))+
  geom_bar()+
  facet_grid(~animal_type)
```

## Exploring chip status

```{r}
## General distribution of variable
adoptions %>%
  filter(dog == 1 | cat == 1) %>%
  ggplot(aes(x=chip_status))+
  geom_bar()+
  facet_grid(~animal_type)

## Relationship with returned to owner status
adoptions %>%
  filter(dog == 1 | cat == 1) %>%
  filter(!is.na(chip_status)) %>%
  mutate(returned = as.factor(ifelse(outcome_type== "RETURNED TO OWNER", 1, 0))) %>%
  ggplot(aes(x=chip_status, fill = returned))+
  geom_bar(position = "fill")
```


## Exploring intake_subtype
```{r}
## Which dog breeds are in our data? 
adoptions %>%
  mutate(intake_subtype = fct_lump(intake_subtype, n=15)) %>%
  group_by(intake_subtype) %>%
  count(sort = TRUE)
```

## Exploring intake_date and outcome_date
```{r}
intake <- adoptions %>%
  mutate(intake_month = month(intake_date, label = TRUE)) %>%
  ggplot(aes(x=intake_month))+
  geom_bar()+ggtitle("Intake Month")
outcome <- adoptions %>%
  filter(!is.na(outcome_date)) %>%
  mutate(outcome_month = month(outcome_date, label = TRUE)) %>%
  ggplot(aes(x=outcome_month))+
  geom_bar()+ ggtitle("Outcome Month")
gridExtra::grid.arrange(intake, outcome)
```

## Pitbulls and Adoptions
```{r}
adoptions %>%
  filter(dog == 1) %>%
  mutate(adopted = as.factor(adopted), 
         pitbull = as.factor(pitbull)) %>%
  ggplot(aes(x = pitbull, fill = adopted))+
  geom_bar(position = "fill")

```

There does not seem to be a large difference between the adoption rates of pitbull and non-pitbulls. We should try and filter out some of the non-adopted dogs though, not all dogs come to the shelter to be adopted. 

```{r}
adoptions %>%
  filter(dog == 1) %>%
  mutate(euthanized = as.factor(euthanized), 
         pitbull = as.factor(pitbull)) %>%
  ggplot(aes(x = pitbull, fill = euthanized))+
  geom_bar(position = "fill")

```

While pitbulls are not adopted at a higher rate, the are euthanized at a higher rate than other dogs. Lets look at all possible outcomes to see how this is possible. 

```{r}
adoptions %>%
  filter(dog == 1) %>%
  mutate(outcome = as.factor(outcome_type), 
         pitbull = as.factor(pitbull)) %>%
  ggplot(aes(x = pitbull, fill = outcome))+
  geom_bar(position = "fill")


adoptions %>%
  filter(dog == 1) %>%
  mutate(outcome = as.factor(outcome_type), 
         pitbull = as.factor(pitbull)) %>%
  group_by(pitbull, outcome_type) %>%
  count(name = "freq") %>%
  group_by(pitbull)%>%
  mutate(freq = freq/ sum(freq))%>%
  spread(outcome_type,freq)
```

A far higher percentage of pitbulls are euthanized than other breeds. Other dogs are adopted, returned to owners, and trasfered at a higher rate. 

## Differences between dogs and cats

```{r}
adoptions %>%
  filter(dog == 1 | cat == 1) %>%
  mutate(DogCat = ifelse(dog == 1, "Dog", "Cat")) %>%
  group_by(DogCat) %>%
  summarise(count = n(),
            meanDays = mean(shelter_days, na.rm = TRUE), 
            prop_euth = sum(euthanized)/count,
            prop_adopt = sum(adopted)/count, 
            prop_stray = sum(stray)/count)
```


```{r}
adoptions %>% 
  filter(dog == 1 | cat == 1) %>%
  filter(shelter_days < 100) %>%
  mutate(DogCat = ifelse(dog == 1, "Dog", "Cat")) %>%
  ggplot(aes(x=shelter_days, y=..density..)) +
  geom_histogram()+
  facet_grid(~DogCat)

```


## What about rabbits? 

```{r}
adoptions  %>%
  filter(animal_breed== "RABBIT SH") %>%
  filter(adopted == 1) %>%
  mutate(month = lubridate::month(outcome_date, label = TRUE)) %>%
  ggplot(aes(x=month)) +
  geom_bar()
```

Alright, so maybe it is not the case that more rabits are adopted over easter. Are there trends in dog adoptions? 

```{r}
adoptions  %>%
  filter(dog == 1 | cat == 1) %>%
  mutate(DogCat = ifelse(dog == 1, "Dog", "Cat")) %>%
  filter(adopted == 1, !is.na(month)) %>%
  mutate(month = lubridate::month(outcome_date, label = TRUE)) %>%
  ggplot(aes(x=month, y = ..prop.., group = 1)) +
  geom_bar()+
  facet_grid(rows = vars(DogCat), switch = "both")
```

#### 1. Exploratory data analysis. Calculate or prepare appropriate numeric and graphical summaries for all relevant variables. Summarize the data using methods that are appropriate to the data type.

#### (a) Most likely you will need to “clean” your dataset first. Make note of any problematic data and observations that need to be removed. Consider implications about any decisions you make about missing data.  

#### (b) Descriptive statistics (5 number summaries for continuous variables; tables of counts and proportions for categorical variables) for all relevant variables in your data set.  Plot continuous variables using histograms.

#### (c) Explore the relationships between important pairs of variables both graphically and numerically.  Depending on the type of your response and explanatory variables, you may consider graphs such as boxplots, scatterplots, cdplots, spaghetti plots, and segmented bar charts, and you may consider summary statistics (like mean, median, standard deviation) by group, correlations, regression equations, and two-way tables with proportions. Exploratory plots can be loose with titles and labels, but for your final paper it is essential that your figures have (meaningful) captions and axis labels!



A few extra details on the EDA Report:

 (a) The Main Body of your report should follow these guidelines: 




(c) General hints for your Stage II report:
•	Aim your report at audience familiar with 272-level statistics, but may be a little rusty.  Also, they have no specific knowledge on your research topic, but they have the ability to catch on quickly. Explain your terms clearly.
•	Show your work and output in an Appendix so your analyses can be reconstructed, if necessary.  
•	Give concise but precise statements interpreting summary statistics, etc. – in the context of your data set and research questions you pose. Avoid vague terms like “this data”, “these results”, etc.  Also avoid cryptic variable names that you may have used in R.
